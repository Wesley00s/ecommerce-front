<div class="min-h-screen bg-gray-50 pt-28 pb-12 px-4 md:px-8">
   <div class="container mx-auto max-w-6xl">
      <div class="flex items-center gap-2 mb-8 text-sm text-gray-500">
         <a routerLink="/cart" class="hover:text-orange-base font-medium"
            >Carrinho</a
         >
         <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-4 w-4"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
         >
            <path
               stroke-linecap="round"
               stroke-linejoin="round"
               stroke-width="2"
               d="M9 5l7 7-7 7"
            />
         </svg>
         <span class="text-gray-900 font-semibold"
            >Confirmação e Pagamento</span
         >
      </div>

      @if (state$ | async; as state) {
         <div class="flex flex-col lg:flex-row gap-8">
            <div class="flex-1 space-y-6">
               <div
                  class="bg-white p-6 rounded-xl shadow-sm border border-gray-100"
               >
                  <h2
                     class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2"
                  >
                     <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-5 w-5 text-orange-base"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                     >
                        <path
                           stroke-linecap="round"
                           stroke-linejoin="round"
                           stroke-width="2"
                           d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                        />
                        <path
                           stroke-linecap="round"
                           stroke-linejoin="round"
                           stroke-width="2"
                           d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                        />
                     </svg>
                     Endereço de Entrega
                  </h2>
                  <div class="pl-7">
                     <p class="font-medium text-gray-800">
                        {{ state.user.name }}
                     </p>
                     <p class="text-gray-600">{{ state.user.street }}</p>
                     <p class="text-gray-600">
                        {{ state.user.city }} - {{ state.user.state }}
                     </p>
                     <p class="text-gray-600">{{ state.user.zip }}</p>
                  </div>
               </div>

               <div
                  class="bg-white p-6 rounded-xl shadow-sm border border-gray-100"
                  [formGroup]="paymentForm"
               >
                  <h2
                     class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2"
                  >
                     <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-5 w-5 text-orange-base"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                     >
                        <path
                           stroke-linecap="round"
                           stroke-linejoin="round"
                           stroke-width="2"
                           d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"
                        />
                     </svg>
                     Forma de Pagamento
                  </h2>

                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                     <label class="cursor-pointer relative">
                        <input
                           type="radio"
                           formControlName="method"
                           value="CREDIT_CARD"
                           class="peer sr-only"
                        />
                        <div
                           class="p-4 rounded-lg border border-gray-200 hover:bg-gray-50 peer-checked:border-orange-base peer-checked:bg-orange-50 transition-all"
                        >
                           <div class="flex items-center gap-3">
                              <svg
                                 xmlns="http://www.w3.org/2000/svg"
                                 class="h-6 w-6 text-gray-600 peer-checked:text-orange-base"
                                 fill="none"
                                 viewBox="0 0 24 24"
                                 stroke="currentColor"
                              >
                                 <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"
                                 />
                              </svg>
                              <span class="font-medium text-gray-900"
                                 >Cartão de Crédito</span
                              >
                           </div>
                        </div>
                     </label>

                     <label class="cursor-pointer relative">
                        <input
                           type="radio"
                           formControlName="method"
                           value="PIX"
                           class="peer sr-only"
                        />
                        <div
                           class="p-4 rounded-lg border border-gray-200 hover:bg-gray-50 peer-checked:border-orange-base peer-checked:bg-orange-50 transition-all"
                        >
                           <div class="flex items-center gap-3">
                              <svg
                                 xmlns="http://www.w3.org/2000/svg"
                                 class="h-6 w-6 text-gray-600 peer-checked:text-orange-base"
                                 fill="none"
                                 viewBox="0 0 24 24"
                                 stroke="currentColor"
                              >
                                 <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M13 10V3L4 14h7v7l9-11h-7z"
                                 />
                              </svg>
                              <span class="font-medium text-gray-900">PIX</span>
                           </div>
                        </div>
                     </label>
                  </div>

                  @if (paymentForm.get("method")?.value === "CREDIT_CARD") {
                     <div class="space-y-4 animate-fade-in">
                        <div>
                           <span
                              class="block text-sm font-medium text-gray-700 mb-1"
                              >Nome no Cartão</span
                           >
                           <input
                              type="text"
                              formControlName="cardHolderName"
                              placeholder="Como impresso no cartão"
                              class="w-full px-4 py-2 rounded-lg border border-gray-300 placeholder-slate-400 focus:ring-2 focus:ring-orange-base focus:border-transparent outline-none transition-all"
                           />
                        </div>

                        <div>
                           <span
                              class="block text-sm font-medium text-gray-700 mb-1"
                              >Dados do Cartão</span
                           >
                           <div
                              class="p-3 border border-gray-300 rounded-lg bg-white"
                           >
                              <ngx-stripe-card
                                 [options]="cardOptions"
                                 [elementsOptions]="elementsOptions"
                              >
                              </ngx-stripe-card>
                           </div>
                        </div>
                     </div>
                  } @else if (paymentForm.get("method")?.value === "PIX") {
                     <div
                        class="p-4 bg-blue-50 text-blue-700 rounded-lg text-sm"
                     >
                        <p>
                           Ao confirmar, um código QR Code será gerado na
                           próxima tela para pagamento instantâneo.
                        </p>
                     </div>
                  }
               </div>
               <div
                  class="bg-white p-6 rounded-xl shadow-sm border border-gray-100"
               >
                  <h2 class="text-lg font-bold text-gray-900 mb-4">
                     Itens do Pedido
                  </h2>
                  <div class="divide-y divide-gray-100">
                     @for (item of state.cart.items; track item.itemID) {
                        <div class="flex gap-4 py-4">
                           <div
                              class="w-16 h-16 bg-gray-50 rounded-md border border-gray-200 overflow-hidden shrink-0"
                           >
                              <img
                                 [ngSrc]="
                                    item.product.coverImageUrl | toRelativePath
                                 "
                                 width="100"
                                 height="100"
                                 class="w-full h-full object-contain"
                                 alt="Product image"
                              />
                           </div>
                           <div class="flex-1 flex justify-between">
                              <div>
                                 <h4
                                    class="text-sm font-medium text-gray-800 line-clamp-2"
                                 >
                                    {{ item.product.name }}
                                 </h4>
                                 <p class="text-xs text-gray-500 mt-1">
                                    Qtd: {{ item.quantity }}
                                 </p>
                              </div>
                              <div class="text-right">
                                 <p class="font-bold text-gray-900">
                                    {{ item.price | currency: "BRL" }}
                                 </p>
                                 <p class="text-xs text-gray-400">
                                    {{ item.product.price | currency: "BRL" }}
                                    un.
                                 </p>
                              </div>
                           </div>
                        </div>
                     }
                  </div>
               </div>
            </div>

            <div class="lg:w-96 shrink-0">
               <div
                  class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 sticky top-28"
               >
                  <h2 class="text-lg font-bold text-gray-900 mb-6">
                     Resumo da Compra
                  </h2>

                  <div
                     class="space-y-3 mb-6 border-b border-gray-100 pb-6 text-sm"
                  >
                     <div class="flex justify-between text-gray-600">
                        <span>Produtos</span>
                        <span>{{
                           state.cart.totalPrice | currency: "BRL"
                        }}</span>
                     </div>
                     <div class="flex justify-between text-gray-600">
                        <span>Frete</span>
                        <span class="text-green-600">Grátis</span>
                     </div>
                  </div>

                  <div class="flex justify-between items-end mb-6">
                     <span class="text-lg font-bold text-gray-900">Total</span>
                     <span class="text-2xl font-bold text-orange-base">{{
                        state.cart.totalPrice | currency: "BRL"
                     }}</span>
                  </div>

                  <app-button
                     [label]="
                        isProcessingOrder
                           ? 'Processando...'
                           : 'Confirmar Pedido'
                     "
                     (clicked)="placeOrder()"
                     class="w-full"
                     [disabled]="isProcessingOrder"
                  >
                  </app-button>

                  <p class="text-xs text-center text-gray-400 mt-4">
                     Ao confirmar, você concorda com nossos termos de serviço.
                  </p>
               </div>
            </div>
         </div>
      } @else {
         <app-loading-spinner></app-loading-spinner>
      }
   </div>
</div>
