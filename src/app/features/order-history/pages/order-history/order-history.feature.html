<div class="min-h-screen bg-gray-50 pt-24 pb-12 px-4 md:px-8">
   <div class="container mx-auto max-w-4xl">
      <div class="flex items-center gap-2 mb-8">
         <a
            routerLink="/"
            class="text-gray-500 hover:text-orange-base transition-colors"
         >
            <svg
               xmlns="http://www.w3.org/2000/svg"
               fill="none"
               viewBox="0 0 24 24"
               stroke-width="2"
               stroke="currentColor"
               class="w-5 h-5"
            >
               <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"
               />
            </svg>
         </a>
         <h1 class="text-2xl md:text-3xl font-bold text-gray-900">
            Meus Pedidos
         </h1>
      </div>

      @if (orders$ | async; as orders) {
         @if (orders.length > 0) {
            <div class="space-y-6">
               @for (order of orders; track order.orderId) {
                  <div
                     class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden transition-all hover:shadow-md"
                  >
                     <div
                        class="bg-gray-50/50 px-4 py-3 md:px-6 flex flex-col md:flex-row justify-between items-start md:items-center gap-4 border-b border-gray-100"
                     >
                        <div class="flex flex-col gap-1">
                           <span class="font-bold text-gray-900"
                              >Pedido #{{ order.orderId }}</span
                           >
                           <span class="text-xs text-gray-500">
                              Realizado em
                              {{
                                 order.createdAt
                                    | date: "dd 'de' MMMM 'de' yyyy"
                              }}
                           </span>
                        </div>

                        <div
                           class="flex items-center gap-4 w-full md:w-auto justify-between md:justify-end"
                        >
                           <span
                              class="px-3 py-1 rounded-full text-xs font-bold border"
                              [ngClass]="getStatusColor(order.orderStatus)"
                           >
                              {{ getStatusLabel(order.orderStatus) }}
                           </span>
                           <span class="font-bold text-gray-900">
                              {{ order.totalPrice | currency: "BRL" }}
                           </span>
                        </div>
                     </div>

                     <div class="p-4 md:p-6">
                        <div class="space-y-4">
                           @for (item of order.items; track item.itemID) {
                              <div class="flex items-center gap-4">
                                 <div
                                    class="h-16 w-16 shrink-0 overflow-hidden rounded-md border border-gray-200 bg-white"
                                 >
                                    <img
                                       [ngSrc]="
                                          item.product.coverImageUrl
                                             | toRelativePath
                                       "
                                       [alt]="item.product.name"
                                       width="100"
                                       height="100"
                                       class="h-full w-full object-contain p-1"
                                    />
                                 </div>

                                 <div class="flex-1 min-w-0">
                                    <h3
                                       class="text-sm font-medium text-gray-900 truncate"
                                    >
                                       <a
                                          [routerLink]="[
                                             '/products/details',
                                             item.product.code,
                                          ]"
                                          class="hover:text-orange-base hover:underline"
                                       >
                                          {{ item.product.name }}
                                       </a>
                                    </h3>
                                    <p class="text-xs text-gray-500 mt-0.5">
                                       {{ item.product.categoryName }}
                                    </p>
                                    <div class="flex items-center gap-2 mt-1">
                                       <span
                                          class="text-xs bg-gray-100 px-2 py-0.5 rounded text-gray-600"
                                       >
                                          Qtd: {{ item.quantity }}
                                       </span>
                                    </div>
                                 </div>

                                 <div class="text-right">
                                    <p
                                       class="text-sm font-medium text-gray-900"
                                    >
                                       {{ item.price | currency: "BRL" }}
                                    </p>
                                    @if (item.quantity > 1) {
                                       <p class="text-[10px] text-gray-400">
                                          {{
                                             item.product.price
                                                | currency: "BRL"
                                          }}
                                          cada
                                       </p>
                                    }
                                 </div>
                              </div>
                           }
                        </div>
                     </div>
                  </div>
               }
            </div>
         } @else {
            <div
               class="flex flex-col items-center justify-center py-20 text-center bg-white rounded-xl shadow-sm border border-gray-100"
            >
               <div class="bg-orange-50 p-6 rounded-full mb-6">
                  <svg
                     xmlns="http://www.w3.org/2000/svg"
                     fill="none"
                     viewBox="0 0 24 24"
                     stroke-width="1.5"
                     stroke="currentColor"
                     class="w-12 h-12 text-orange-base"
                  >
                     <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"
                     />
                  </svg>
               </div>
               <h2 class="text-xl font-bold text-gray-900 mb-2">
                  Nenhum pedido encontrado
               </h2>
               <p class="text-gray-500 mb-8 max-w-xs mx-auto">
                  Você ainda não fez nenhuma compra. Aproveite nossas ofertas!
               </p>
               <a
                  routerLink="/"
                  class="px-6 py-2.5 bg-orange-base text-white font-bold rounded-lg hover:bg-orange-dark transition-colors shadow-sm"
               >
                  Começar a Comprar
               </a>
            </div>
         }
      } @else {
         <app-loading-spinner
            [message]="'Carregando histórico...'"
         ></app-loading-spinner>
      }
   </div>
</div>
