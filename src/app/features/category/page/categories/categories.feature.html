<div class="container min-h-full">
   @if (state$ | async; as state) {
      @if (state.found && !state.error) {
         <div class="mb-6 md:mb-8 border-b border-gray-200 pb-6">
            <div
               class="flex items-center gap-2 text-xs md:text-sm text-gray-500 mb-2"
            >
               <a
                  routerLink="/"
                  class="hover:text-orange-base transition-colors"
                  >Home</a
               >
               <span>/</span>
               <span>Categorias</span>
            </div>

            <h1
               class="text-2xl md:text-head-md font-bold text-primary capitalize mb-6"
            >
               {{ state.categoryName }}
            </h1>

            <app-filter-bar
               [placeholder]="'Buscar em ' + state.categoryName + '...'"
               (filterChange)="onFilterChange($event)"
            >
            </app-filter-bar>

            <p class="text-sm md:text-base text-gray-500 mt-4">
               Exibindo <strong>{{ state.products.length }}</strong> de
               <strong>{{ state.pagination.totalElements }}</strong> produtos
            </p>
         </div>
      }

      @if (state.loading) {
         <app-loading-container
            message="Buscando produtos..."
         ></app-loading-container>
      }

      @if (state.error) {
         <div class="text-center py-12 md:py-20">
            <h2 class="text-xl md:text-2xl font-bold text-red-600 mb-2">
               Ops!
            </h2>
            <p class="text-sm md:text-base text-gray-600">
               Ocorreu um erro ao carregar.
            </p>
            <a
               routerLink="/"
               class="text-sm md:text-base text-blue-600 hover:underline mt-4 inline-block"
               >Voltar para Home</a
            >
         </div>
      }

      @if (!state.loading && !state.error) {
         @if (state.found) {
            @if (state.products.length > 0) {
               <div
                  class="flex flex-wrap justify-center md:justify-start md:gap-5 animate-fade-in-up delay-100"
               >
                  @for (product of state.products; track product.id) {
                     <app-product-card [product]="product" class="h-full">
                     </app-product-card>
                  }
               </div>

               @if (state.pagination.totalPages > 1) {
                  <div
                     class="flex flex-col sm:flex-row justify-center items-center gap-4 mb-10"
                  >
                     <button
                        (click)="prevPage(state.pagination.page)"
                        [disabled]="state.pagination.page === 0"
                        class="flex items-center justify-center px-4 h-10 text-base font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                     >
                        <svg
                           class="w-3.5 h-3.5 mr-2"
                           aria-hidden="true"
                           xmlns="http://www.w3.org/2000/svg"
                           fill="none"
                           viewBox="0 0 14 10"
                        >
                           <path
                              stroke="currentColor"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke-width="2"
                              d="M13 5H1m0 0 4 4M1 5l4-4"
                           />
                        </svg>
                        Anterior
                     </button>
                     <span class="text-sm text-gray-700">
                        Página
                        <span class="font-semibold text-gray-900">{{
                           state.pagination.page + 1
                        }}</span>
                        de
                        <span class="font-semibold text-gray-900">{{
                           state.pagination.totalPages
                        }}</span>
                     </span>
                     <button
                        (click)="
                           nextPage(
                              state.pagination.page,
                              state.pagination.totalPages
                           )
                        "
                        [disabled]="
                           state.pagination.page >=
                           state.pagination.totalPages - 1
                        "
                        class="flex items-center justify-center px-4 h-10 text-base font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                     >
                        Próxima
                        <svg
                           class="w-3.5 h-3.5 ml-2"
                           aria-hidden="true"
                           xmlns="http://www.w3.org/2000/svg"
                           fill="none"
                           viewBox="0 0 14 10"
                        >
                           <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke-width="2"
                              d="M1 5h12m0 0L9 1m4 4L9 9"
                           />
                        </svg>
                     </button>
                  </div>
               }
            } @else {
               <div
                  class="text-center py-12 md:py-20 bg-gray-50 rounded-xl border border-gray-200"
               >
                  <p class="text-base md:text-xl text-gray-600 font-medium">
                     Nenhum produto encontrado.
                  </p>
                  <button
                     (click)="clearFilters()"
                     class="mt-4 text-orange-base hover:underline"
                  >
                     Limpar filtros
                  </button>
               </div>
            }
         } @else {
            <div class="text-center py-12 md:py-20">
               <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-2">
                  Categoria não encontrada
               </h2>
               <a
                  routerLink="/"
                  class="text-blue-600 hover:underline mt-4 inline-block"
                  >Ver todas as categorias</a
               >
            </div>
         }
      }
   }
</div>
