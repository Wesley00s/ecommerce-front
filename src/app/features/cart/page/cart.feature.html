<div class="min-h-screen bg-gray-50 pt-28 pb-12 px-4 md:px-8">
   <div class="container mx-auto max-w-6xl">
      <h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-8">
         Meu Carrinho
      </h1>

      @if (loading) {
         <app-loading-spinner></app-loading-spinner>
      } @else {
         @if (cart$ | async; as cart) {
            @if (cart.items.length > 0) {
               <div class="flex flex-col lg:flex-row gap-8">
                  <div
                     class="flex-1 bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"
                  >
                     <div
                        class="bg-gray-50 px-6 py-3 border-b border-gray-200 flex justify-between items-center"
                     >
                        <span class="text-sm font-medium text-gray-600"
                           >Produto</span
                        >
                        <span
                           class="text-sm font-medium text-gray-600 hidden md:block"
                           >Preço / Qtd</span
                        >
                     </div>

                     <div class="px-4 md:px-6">
                        @for (item of cart.items; track item.itemID) {
                           <app-cart-item
                              [item]="item"
                              (quantityUpdate)="
                                 handleQuantityUpdate(item, $event)
                              "
                              (remove)="handleRemoveItem(item)"
                              (toggleSelect)="handleToggleSelect(item, $event)"
                           >
                           </app-cart-item>
                        }
                     </div>
                  </div>

                  <div class="lg:w-96 shrink-0">
                     <div
                        class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 sticky top-28"
                     >
                        <h2 class="text-lg font-bold text-gray-900 mb-6">
                           Resumo do Pedido
                        </h2>

                        <div
                           class="space-y-3 mb-6 border-b border-gray-100 pb-6"
                        >
                           <div class="flex justify-between text-gray-600">
                              <span
                                 >Subtotal ({{
                                    selectedItemsCount$ | async
                                 }}
                                 itens)</span
                              >
                              <span>{{
                                 cart.totalPrice | currency: "BRL"
                              }}</span>
                           </div>
                           <div class="flex justify-between text-gray-600">
                              <span>Frete</span>
                              <span class="text-green-600 font-medium"
                                 >Grátis</span
                              >
                           </div>
                        </div>

                        <div class="flex justify-between items-end mb-6">
                           <span class="text-lg font-medium text-gray-900"
                              >Total</span
                           >
                           <div class="text-right">
                              <span
                                 class="block text-2xl font-bold text-gray-900"
                                 >{{ cart.totalPrice | currency: "BRL" }}</span
                              >
                              <span class="text-xs text-gray-500"
                                 >ou 10x de
                                 {{ cart.totalPrice / 10 | currency: "BRL" }} s/
                                 juros</span
                              >
                           </div>
                        </div>

                        <app-button
                           [label]="'Finalizar Compra'"
                           (clicked)="checkout()"
                           class="w-full"
                           [disabled]="cart.totalPrice <= 0"
                        >
                        </app-button>

                        <div
                           class="mt-4 flex items-center justify-center gap-2 text-xs text-gray-400"
                        >
                           <svg
                              xmlns="http://www.w3.org/2000/svg"
                              fill="none"
                              viewBox="0 0 24 24"
                              stroke-width="1.5"
                              stroke="currentColor"
                              class="w-4 h-4"
                           >
                              <path
                                 stroke-linecap="round"
                                 stroke-linejoin="round"
                                 d="M9 12.75L11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 01-1.043 3.296 3.745 3.745 0 01-3.296 1.043A3.745 3.745 0 0112 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 01-3.296-1.043 3.745 3.745 0 01-1.043-3.296A3.745 3.745 0 013 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 011.043-3.296 3.746 3.746 0 013.296-1.043A3.746 3.746 0 0112 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 013.296 1.043 3.746 3.746 0 011.043 3.296A3.745 3.745 0 0121 12z"
                              />
                           </svg>
                           Compra Segura e Garantida
                        </div>
                     </div>
                  </div>
               </div>
            } @else {
               <div
                  class="flex flex-col items-center justify-center py-20 bg-white rounded-xl shadow-sm border border-gray-100 text-center"
               >
                  <div class="bg-orange-50 p-6 rounded-full mb-6">
                     <img
                        src="assets/images/cart.svg"
                        class="w-16 h-16 opacity-50 grayscale"
                        alt="Carrinho Vazio"
                     />
                  </div>
                  <h2 class="text-2xl font-bold text-gray-900 mb-2">
                     Seu carrinho está vazio
                  </h2>
                  <p class="text-gray-500 mb-8 max-w-md">
                     Parece que você ainda não adicionou nenhum produto. Explore
                     nossa loja e encontre as melhores ofertas!
                  </p>
                  <a
                     routerLink="/shop"
                     class="px-8 py-3 bg-orange-base text-white font-bold rounded-full hover:bg-orange-dark transition-colors shadow-md hover:shadow-lg"
                  >
                     Começar a Comprar
                  </a>
               </div>
            }
         }
      }
   </div>
</div>

@if (isRemoveModalOpen) {
   <app-alert-modal
      title="Remover Produto"
      [message]="
         'Tem certeza que deseja remover ' +
         (itemToRemove?.product?.name || 'este item') +
         ' do seu carrinho?'
      "
      confirmButtonText="Sim, remover"
      cancelButtonText="Cancelar"
      (confirm)="confirmRemoval()"
      (alertClose)="closeRemoveModal()"
   ></app-alert-modal>
}
