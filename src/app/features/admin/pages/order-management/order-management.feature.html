<div class="container mx-auto lg:p-8 max-w-6xl">
   <h1
      class="text-lg lg:text-2xl font-bold mb-6 pb-2 border-b-2 border-orange-base"
   >
      Gerenciamento de Pedidos
   </h1>

   @if (state$ | async; as state) {
      @if (state.error) {
         <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-6">
            <p class="font-bold text-red-700">Erro</p>
            <p class="text-red-600 text-sm">{{ state.errorMessage }}</p>
         </div>
      }

      @if (state.loading) {
         <app-loading-spinner></app-loading-spinner>
      } @else {
         <app-order-table
            [orders]="state.orders.data"
            (approve)="onApprove($event)"
            (reject)="onReject($event)"
            (viewDetails)="openDetails($event)"
         >
         </app-order-table>

         @if (state.orders.pagination.totalPages > 1) {
            <div
               class="flex flex-col sm:flex-row justify-between items-center mt-6 gap-4"
            >
               <span class="text-xs text-gray-700">
                  Página
                  <span class="font-bold">{{
                     state.orders.pagination.page + 1
                  }}</span>
                  de
                  <span class="font-bold">{{
                     state.orders.pagination.totalPages
                  }}</span>
                  (Total: {{ state.orders.pagination.totalElements }})
               </span>

               <div class="inline-flex gap-2">
                  <button
                     (click)="prevPage(state.orders.pagination.page)"
                     [disabled]="state.orders.pagination.page === 0"
                     class="px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                  >
                     Anterior
                  </button>
                  <button
                     (click)="
                        nextPage(
                           state.orders.pagination.page,
                           state.orders.pagination.totalPages
                        )
                     "
                     [disabled]="
                        state.orders.pagination.page >=
                        state.orders.pagination.totalPages - 1
                     "
                     class="px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                  >
                     Próxima
                  </button>
               </div>
            </div>
         }
      }
   }
</div>

@if (isRejectModalOpen) {
   <app-alert-modal
      title="Rejeitar Pedido"
      [message]="
         'Tem certeza que deseja rejeitar o pedido #' +
         orderToRejectId +
         '? Esta ação não pode ser desfeita.'
      "
      confirmButtonText="Sim, Rejeitar"
      cancelButtonText="Cancelar"
      (confirm)="confirmRejection()"
      (alertClose)="closeRejectModal()"
   ></app-alert-modal>
}

@if (isApprovedModalOpen) {
   <app-alert-modal
      title="Aprovar pedido Pedido"
      [message]="
         'Tem certeza que deseja aprovar o pedido #' +
         orderToApproveId +
         '? Esta ação não pode ser desfeita.'
      "
      confirmButtonText="Sim, Aprovar"
      cancelButtonText="Cancelar"
      (confirm)="confirmApprove()"
      (alertClose)="closeApproveModal()"
   ></app-alert-modal>
}

@if (selectedOrder) {
   <app-order-details-modal
      [order]="selectedOrder"
      (approve)="onApprove($event)"
      (reject)="onReject($event)"
      (modalClose)="closeDetails()"
   ></app-order-details-modal>
}
