<div class="flex items-start gap-3">
   <img
      ngSrc="assets/icons/avatar.svg"
      alt="Avatar do comentador"
      width="36"
      height="36"
      class="rounded-full mt-1"
   />
   <div class="flex-1">
      <div class="bg-slate-100 rounded-lg p-3">
         <div class="flex items-center justify-between">
            <div class="flex items-center gap-2">
               <h4 class="font-semibold text-sm text-slate-800">
                  {{ comment.customerName }}
               </h4>
               <span class="text-xs text-slate-400 pt-0.5">•</span>
               <p class="text-xs text-slate-500 pt-0.5">
                  {{ comment.createdAt | date: "dd/MM/yy, HH:mm" }}
               </p>
            </div>
            @if (isOwner) {
               <div class="relative">
                  <button
                     (click)="toggleToolbox()"
                     class="p-1 rounded-full text-slate-500 hover:bg-slate-200"
                     aria-label="Opções do comentário"
                  >
                     <img
                        ngSrc="assets/icons/dots-vertical.svg"
                        alt="Opções"
                        width="20"
                        height="20"
                     />
                  </button>
                  @if (isToolboxOpen) {
                     <div
                        (click)="$event.stopPropagation()"
                        (keydown.enter)="$event.stopPropagation()"
                        tabindex="0"
                        class="absolute top-full right-0 mt-1 w-36 bg-white border border-slate-200 rounded-md shadow-lg z-10 toolbox-animate"
                     >
                        <ul class="py-1">
                           <li>
                              <button
                                 (click)="onEdit()"
                                 class="w-full text-left px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 flex items-center gap-2"
                              >
                                 <img
                                    ngSrc="assets/icons/edit.svg"
                                    alt="Editar"
                                    width="16"
                                    height="16"
                                 />
                                 <span>Editar</span>
                              </button>
                           </li>
                           <li>
                              <button
                                 (click)="onDelete()"
                                 class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center gap-2"
                              >
                                 <img
                                    ngSrc="assets/icons/delete.svg"
                                    alt="Deletar"
                                    width="16"
                                    height="16"
                                 />
                                 <span>Deletar</span>
                              </button>
                           </li>
                        </ul>
                     </div>
                  }
               </div>
            }
         </div>
         <p
            class="text-sm text-slate-700 mt-1 review-text"
            [class.expanded]="isExpanded"
            appOverflowDetector
            (isOverflowing)="onOverflowChange($event)"
            [innerHTML]="comment.content | mentionHighlighter"
         ></p>
         @if (contentIsOverflowing) {
            <button
               (click)="toggleExpand()"
               class="flex items-center gap-1 mt-1 text-xs text-blue-600 hover:underline focus:outline-none"
            >
               <span>{{ isExpanded ? "Ver menos" : "Ver mais" }}</span>
            </button>
         }
      </div>

      <div
         class="flex items-center gap-2 text-slate-600 my-4 [&>*]:cursor-pointer"
      >
         <button
            (click)="onLike()"
            [class.text-blue-600]="comment.likedByMe"
            [class.font-bold]="comment.likedByMe"
            class="flex items-center gap-1.5 px-3 py-1 rounded-full hover:bg-slate-200 transition-colors"
            title="Gostei"
         >
            @if (comment.likedByMe) {
               <img
                  ngSrc="/assets/icons/like-full.svg"
                  alt="Gostei"
                  width="18"
                  height="18"
               />
            } @else {
               <img
                  ngSrc="/assets/icons/like.svg"
                  alt="Gostei"
                  width="18"
                  height="18"
               />
            }
            <span class="text-sm font-medium">{{ comment.likes }}</span>
         </button>

         <button
            (click)="onDislike()"
            [class.text-red-600]="comment.dislikedByMe"
            [class.font-bold]="comment.dislikedByMe"
            class="flex items-center gap-1.5 px-3 py-1 rounded-full hover:bg-slate-200 transition-colors"
            title="Não Gostei"
         >
            @if (comment.dislikedByMe) {
               <img
                  ngSrc="/assets/icons/dislike-full.svg"
                  alt="Não Gostei"
                  width="18"
                  height="18"
               />
            } @else {
               <img
                  ngSrc="/assets/icons/dislike.svg"
                  alt="Não Gostei"
                  width="18"
                  height="18"
               />
            }
            <span class="text-sm font-medium">{{ comment.dislikes }}</span>
         </button>

         <button
            (click)="onReply()"
            class="flex items-center gap-1.5 px-3 py-1 rounded-full hover:bg-slate-200 transition-colors"
            title="Responder"
         >
            <img
               ngSrc="/assets/icons/reply.svg"
               alt="Responder"
               width="18"
               height="18"
            />
         </button>
      </div>
   </div>
</div>
